{"title":"PANDA的安装及使用","date":"2018-09-04T02:19:49.000Z","excerpt":"","slug":"PANDA的安装及使用","updated":"2018-09-04T02:57:06.370Z","content":"<h1 id=\"1-PANDA及其运行环境安装\"><a href=\"#1-PANDA及其运行环境安装\" class=\"headerlink\" title=\"1 PANDA及其运行环境安装\"></a>1 PANDA及其运行环境安装</h1><h2 id=\"1-1-安装PANDA\"><a href=\"#1-1-安装PANDA\" class=\"headerlink\" title=\"1.1 安装PANDA\"></a>1.1 安装PANDA</h2><ul>\n<li>首先，在GitHub上根据官方文档安装。地址：<a href=\"https://github.com/panda-re/panda\" target=\"_blank\" rel=\"noopener\">https://github.com/panda-re/panda</a></li>\n</ul>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo add-apt-repository ppa:phulin/panda</span><br><span class=\"line\">sudo apt-get update</span><br><span class=\"line\">sudo apt-get build-dep qemu</span><br><span class=\"line\">sudo apt-get install python-pip git protobuf-compiler protobuf-c-compiler \\</span><br><span class=\"line\">  libprotobuf-c0-dev libprotoc-dev python-protobuf libelf-dev \\</span><br><span class=\"line\">  libcapstone-dev libdwarf-dev python-pycparser llvm-3.3 clang-3.3 libc++-dev</span><br><span class=\"line\">git clone https://github.com/panda-re/panda</span><br><span class=\"line\">mkdir -p build-panda &amp;&amp; cd build-panda</span><br><span class=\"line\">../panda/build.sh</span><br></pre></td></tr></table></figure>\n<p>安装代码就是这一小段，选用的主机操作系统是Ubuntu 14.04。</p>\n<h2 id=\"1-2-安装QEMU\"><a href=\"#1-2-安装QEMU\" class=\"headerlink\" title=\"1.2 安装QEMU\"></a>1.2 安装QEMU</h2><ul>\n<li>在官网下载qemu2.8。</li>\n<li>拷贝到某个目录下进行解压缩</li>\n</ul>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tar -Jxvf 源文件 -C 目标文件夹 </span><br><span class=\"line\">如：tar -Jxvf qemu-2.8.1.1.tar.xz -C /home/yuan</span><br></pre></td></tr></table></figure>\n<ul>\n<li>在~目录下新建一个build-qemu文件夹，转到该文件夹进行qemu的configure。</li>\n</ul>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd ~</span><br><span class=\"line\">mkdir -p build-qemu &amp;&amp; cd build-qemu</span><br><span class=\"line\">../qemu/configure --enalbe-debug</span><br></pre></td></tr></table></figure>\n<ul>\n<li>然后再make一下</li>\n</ul>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">make -j4        //电脑是四核的，所以-j4，运行起来更快</span><br></pre></td></tr></table></figure>\n<h2 id=\"1-3-QEMU安装win7\"><a href=\"#1-3-QEMU安装win7\" class=\"headerlink\" title=\"1.3 QEMU安装win7\"></a>1.3 QEMU安装win7</h2><ul>\n<li>首先，在~目录下创建一个image文件夹，然后创建一个win7.qcow2文件。</li>\n</ul>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd ~</span><br><span class=\"line\">mkdir -p image</span><br><span class=\"line\">cd image</span><br><span class=\"line\">qemu-img create -f qcow2 win7.qcow2 8G</span><br></pre></td></tr></table></figure>\n<ul>\n<li>然后将win7的镜像文件拷贝到win7.qcow2所在目录下。</li>\n<li>转到/home/yuan/build-qemu/i386-softmmu目录下执行</li>\n</ul>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">./qemu-system-i386 -m 512 -hda /home/yuan/IMG/win7.qcow2 -cdrom /home/yuan/IMG/win7.iso -boot d -enable-kvm</span><br><span class=\"line\">（如果需要鼠标控制则加上 -usbdevice tablet ，如果要加速则加上-enable-kvm）</span><br></pre></td></tr></table></figure>\n<h3 id=\"遇到的小问题\"><a href=\"#遇到的小问题\" class=\"headerlink\" title=\"遇到的小问题\"></a>遇到的小问题</h3><p>一开始显示我电脑不支持kvm，于是上网搜罗了一大堆原因，如下：</p>\n<p>How to fix error ‘Could not access KVM kernel module’ in Proxmox, Virtualizor, SolusVM, Redhat, CentOS and Ubuntu：</p>\n<p><a href=\"https://bobcares.com/blog/how-to-fix-error-could-not-access-kvm-kernel-module/\" target=\"_blank\" rel=\"noopener\">https://bobcares.com/blog/how-to-fix-error-could-not-access-kvm-kernel-module/</a></p>\n<p>查看是否可虚拟化：</p>\n<p><a href=\"http://www.linuxidc.com/Linux/2012-09/69714.htm\" target=\"_blank\" rel=\"noopener\">http://www.linuxidc.com/Linux/2012-09/69714.htm</a></p>\n<p>最后才发现原来是这个原因，就因为这么一个低级错误竟然害我折腾了一晚上的时间。。。</p>\n<p><a href=\"http://yang19890314.blog.51cto.com/1620466/1136803\" target=\"_blank\" rel=\"noopener\">http://yang19890314.blog.51cto.com/1620466/1136803</a></p>\n<h2 id=\"1-4-运行小测试\"><a href=\"#1-4-运行小测试\" class=\"headerlink\" title=\"1.4 运行小测试\"></a>1.4 运行小测试</h2><ul>\n<li>在PANDA中启动qemu</li>\n</ul>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd /home/yuan/build-panda/i386-softmmu</span><br><span class=\"line\">./qemu-system-i386 -m 512 -hda /home/yuan/IMG/win7.qcow2 -monitor stdio -usbdevice tablet</span><br><span class=\"line\">或者</span><br><span class=\"line\">./qemu-system-i386 –m 1024 –os windows-32-7 –drive file=/home/bling/image/win7.qcow2 –monitor stdio</span><br></pre></td></tr></table></figure>\n<ul>\n<li>在qemu中启动虚拟机</li>\n</ul>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd /home/yuan/build-qemu/i386-softmmu</span><br><span class=\"line\">./qemu-system-i386 -m 512 -hda /home/yuan/IMG/win7.qcow2 -enable-kvm -monitor stdio -usbdevice tablet</span><br></pre></td></tr></table></figure>\n<h2 id=\"1-5-安装vsftp\"><a href=\"#1-5-安装vsftp\" class=\"headerlink\" title=\"1.5 安装vsftp\"></a>1.5 安装vsftp</h2><ul>\n<li>执行如下命令</li>\n</ul>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo apt-get install vsftpd</span><br><span class=\"line\">sudo gedit /etc/vsftpd.conf</span><br></pre></td></tr></table></figure>\n<ul>\n<li>更改vsftpd.conf中的dir项，改成本机中的某个文件夹，用来传输文件给qemu中的win7虚拟机。</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">secure chroot dir=/home/yuan/ftpShare</span><br></pre></td></tr></table></figure>\n<ul>\n<li>ifconfig一下，查看ip地址。</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ifconfig</span><br><span class=\"line\">(eth0   inet addr:192.168.43.19)</span><br><span class=\"line\">(lo     inet addr:127.0.0.1)</span><br></pre></td></tr></table></figure>\n<p>然后配置相应参数。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo service vsftpd restart</span><br><span class=\"line\">ftp 127.0.0.1</span><br><span class=\"line\">(name:  )</span><br><span class=\"line\">(Password:  )</span><br><span class=\"line\">quit</span><br></pre></td></tr></table></figure>\n<ul>\n<li>配置完成后，打开qemu模拟器，在IE浏览器中输入<a href=\"ftp://192.168.43.19/，然后输入上面设置的用户名和密码，即可访问Ubuntu主机中ftpShare目录下的文件了。\" target=\"_blank\" rel=\"noopener\">ftp://192.168.43.19/，然后输入上面设置的用户名和密码，即可访问Ubuntu主机中ftpShare目录下的文件了。</a></li>\n</ul>\n<h1 id=\"2-使用PANDA\"><a href=\"#2-使用PANDA\" class=\"headerlink\" title=\"2 使用PANDA\"></a>2 使用PANDA</h1><h2 id=\"2-1-用PANDA打开qemu\"><a href=\"#2-1-用PANDA打开qemu\" class=\"headerlink\" title=\"2.1 用PANDA打开qemu\"></a>2.1 用PANDA打开qemu</h2><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd /home/yuan/build-panda/i386-softmmu</span><br><span class=\"line\">./qemu-system-i386 /home/yuan/image/win7.qcow2 -m 1024 -monitor stdio -usbdevice tablet</span><br><span class=\"line\">或者</span><br><span class=\"line\">./qemu-system-i386 -hda /home/yuan/image/win7.qcow2 -m 1024 -monitor stdio -usbdevice tablet</span><br></pre></td></tr></table></figure>\n<p>记录重放文件：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">begin_record xxx        //选择一个点开始拍摄快照，记录</span><br><span class=\"line\">end_record          //结束记录</span><br><span class=\"line\">quit</span><br></pre></td></tr></table></figure>\n<p>运行重放文件：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">./qemu-system-i386 -replay itry -hda /home/kumquat_cc/IMG/win7.qcow2 -m 512 -monitor stdio -usbdevice tablet</span><br></pre></td></tr></table></figure>\n<h1 id=\"2-2-使用scissors插件\"><a href=\"#2-2-使用scissors插件\" class=\"headerlink\" title=\"2.2 使用scissors插件\"></a>2.2 使用scissors插件</h1><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">./qemu-system-i386 -m 512 -hda /home/kumquat_cc/IMG/win7.qcow2 -monitor stdio -usbdevice tablet -replay itry -panda scissors:name=cutstart,start=39410248,end=72252110</span><br><span class=\"line\">或者</span><br><span class=\"line\">./qemu-system-i386 -m 1024 -replay xxx -panda scissors:name=xxxxx,start=num1,end=num2</span><br></pre></td></tr></table></figure>\n<h1 id=\"2-3-使用test插件\"><a href=\"#2-3-使用test插件\" class=\"headerlink\" title=\"2.3 使用test插件\"></a>2.3 使用test插件</h1><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">./qemu-system-i386 -m 1024 -os windows-32-7 -replay xxx -panda test:path=/home/bling/mytraces/xxxx.db</span><br><span class=\"line\">或者</span><br><span class=\"line\">./qemu-system-i386 -replay XXX -m 1024 -os windows-32-7 -panda osi -panda test:process_name=XXX.exe,path=/home/bling/mytraces/XXX.db -panda win7x86intro</span><br></pre></td></tr></table></figure>\n<h1 id=\"2-4-添加新插件\"><a href=\"#2-4-添加新插件\" class=\"headerlink\" title=\"2.4 添加新插件\"></a>2.4 添加新插件</h1><blockquote>\n<p>1、将插件文件放在../panda/panda/plugins/目录下</p>\n</blockquote>\n<blockquote>\n<p>2、在config.panda中添加新插件的名字</p>\n</blockquote>\n<blockquote>\n<p>3、在build-panda中make一下</p>\n</blockquote>\n","prev":{"title":"linux4.4.0安装EP-DB1608驱动","slug":"linux4.4.0安装EP-DB1608驱动"},"link":"/2018/09/04","toc":[{"title":"1 PANDA及其运行环境安装","id":"1-PANDA及其运行环境安装","index":"1","children":[{"title":"1.1 安装PANDA","id":"1-1-安装PANDA","index":"1.1"},{"title":"1.2 安装QEMU","id":"1-2-安装QEMU","index":"1.2"},{"title":"1.3 QEMU安装win7","id":"1-3-QEMU安装win7","index":"1.3","children":[{"title":"遇到的小问题","id":"遇到的小问题","index":"1.3.1"}]},{"title":"1.4 运行小测试","id":"1-4-运行小测试","index":"1.4"},{"title":"1.5 安装vsftp","id":"1-5-安装vsftp","index":"1.5"}]},{"title":"2 使用PANDA","id":"2-使用PANDA","index":"2","children":[{"title":"2.1 用PANDA打开qemu","id":"2-1-用PANDA打开qemu","index":"2.1"}]},{"title":"2.2 使用scissors插件","id":"2-2-使用scissors插件","index":"3"},{"title":"2.3 使用test插件","id":"2-3-使用test插件","index":"4"},{"title":"2.4 添加新插件","id":"2-4-添加新插件","index":"5"}]}